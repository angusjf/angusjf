<!DOCTYPE html>
  <html lang="en">
  <head>
    <link rel="stylesheet" href="/style.css">
    
    <link rel="preload" href="/elm.js" as="script">
    <link rel="modulepreload" href="/index.js">
    
    <script defer="defer" src="/elm.js" type="text/javascript"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script type="module">
import userInit from"/index.js";
let prefetchedPages=[window.location.pathname],initialLocationHash=document.location.hash.replace(/^#/,"");function loadContentAndInitializeApp(){let a=window.location.pathname.replace(/(w)$/,"$1/");a.endsWith("/")||(a+="/");const b=Elm.TemplateModulesBeta.init({flags:{secrets:null,baseUrl:document.baseURI,isPrerendering:!1,isDevServer:!1,isElmDebugMode:!1,contentJson:JSON.parse(document.getElementById("__ELM_PAGES_DATA__").innerHTML),userFlags:userInit.flags()}});return b.ports.toJsPort.subscribe(()=>{loadNamedAnchor()}),b}function loadNamedAnchor(){if(""!==initialLocationHash){const a=document.querySelector(`[name=${initialLocationHash}]`);a&&a.scrollIntoView()}}function prefetchIfNeeded(a){if(a.host===window.location.host&&!prefetchedPages.includes(a.pathname)){prefetchedPages.push(a.pathname),console.log("Preloading...",a.pathname);const b=document.createElement("link");b.setAttribute("as","fetch"),b.setAttribute("rel","prefetch"),b.setAttribute("href",origin+a.pathname+"/content.json"),document.head.appendChild(b)}}const appPromise=new Promise(function(a){document.addEventListener("DOMContentLoaded",()=>{a(loadContentAndInitializeApp())})});userInit.load(appPromise),"function"==typeof connect&&connect(function(a){appPromise.then(b=>{b.ports.fromJsPort.send({contentJson:a})})});const trigger_prefetch=b=>{const c=find_anchor(b.target);c&&c.href&&c.hasAttribute("elm-pages:prefetch")&&prefetchIfNeeded(c)};let mousemove_timeout;const handle_mousemove=a=>{clearTimeout(mousemove_timeout),mousemove_timeout=setTimeout(()=>{trigger_prefetch(a)},20)};addEventListener("touchstart",trigger_prefetch),addEventListener("mousemove",handle_mousemove);function find_anchor(a){for(;a&&"A"!==a.nodeName.toUpperCase();)a=a.parentNode;return a}
    </script>
    <title>On the Embarrassingly Poor Performance of JavaScript's Spread Operator</title>
    <meta name="generator" content="elm-pages v2.1.10">
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="canonical" href="https://angusjf.com/js-spread-operator" />    <meta name="description" content="On the Embarrassingly Poor Performance of JavaScript&apos;s Spread Operator" />    <meta property="og:image" content="https://angusjf.com/images/none" />    <meta property="og:image:secure_url" content="https://angusjf.com/images/none" />    <meta property="og:image:alt" content="No alt" />    <meta property="og:title" content="On the Embarrassingly Poor Performance of JavaScript&apos;s Spread Operator" />    <meta property="og:url" content="https://angusjf.com/js-spread-operator" />    <meta property="og:description" content="On the Embarrassingly Poor Performance of JavaScript&apos;s Spread Operator" />    <meta property="og:site_name" content="angusjf" />    <meta property="twitter:card" content="summary" />    <meta property="twitter:title" content="On the Embarrassingly Poor Performance of JavaScript&apos;s Spread Operator" />    <meta property="twitter:description" content="On the Embarrassingly Poor Performance of JavaScript&apos;s Spread Operator" />    <meta property="twitter:image" content="https://angusjf.com/images/none" />    <meta property="twitter:image:alt" content="No alt" />    <meta property="og:type" content="article" />    <meta property="article:published_time" content="2022-08-05" />    <meta property="article:tag" content="javascript" />    <meta property="article:tag" content="typescript" />    <meta property="article:tag" content="performance" />    <link rel="sitemap" type="application/xml" href="/sitemap.xml" />    <link rel="icon" type="image/png" href="https://angusjf.com/favicon.png" />    <link rel="icon" sizes="16x16" type="image/png" href="https://angusjf.com/favicon-16x16.png" />    <link rel="icon" sizes="32x32" type="image/png" href="https://angusjf.com/favicon-32x32.png" />    <link rel="apple-touch-icon" sizes="180x180" href="https://angusjf.com/apple-touch-icon.png" />    <meta name="msapplication-TileColor" content="#da532c" />    <meta name="theme-color" content="#ffffff" />
    <script id="__ELM_PAGES_DATA__" type="application/json">{"staticData":{"1513671225":"[\"content/blog/js-spread-operator.md\"]","2200473815":"{\"parsedFrontmatter\":{\"title\":\"On the Embarrassingly Poor Performance of JavaScript's Spread Operator\",\"img_url\":\"images/none\",\"img_alt\":\"No alt\",\"date\":\"2022-08-05\",\"seo_description\":\"On the Embarrassingly Poor Performance of JavaScript's Spread Operator\",\"summary\":\"On the Embarrassingly Poor Performance of JavaScript's Spread Operator\",\"tags\":[\"javascript\",\"typescript\",\"performance\"],\"hidden\":true},\"withoutFrontmatter\":\"# On the Embarrassingly Poor Performance of JavaScript's Spread Operator\\n\\nHere is an example of immutable TypeScript code which is so inefficient it caused the lambda it was running on to time out.\\n\\nSay we have a list of connections between airports:\\n```ts\\nconst links = [ ['Heathrow', 'Paris'], ['Berlin', 'Brussels'] /* ... */ ];\\n```\\n\\nAnd we want to format this data as a \\\"dictionary\\\", from airport to it's potential destinations:\\n```ts\\n{\\n    Heathrow: ['Paris', 'Berlin', 'Brussels'],\\n    Gatwick: [ /* ... */ ]\\n}\\n```\\n\\nIf we are strictly using immutable javascript, we end up with this:\\n\\n```ts\\nconst validDestinations = (links) =>\\n    links.reduce(\\n        (acc, [from, to]) =>\\n            ({ ...acc,\\n               [from]: [ ...(acc[from] ?? []), to ]\\n             }),\\n        {}\\n    )\\n```\\n\\n_(I know the number of symbols in the above snippet will make any reader born before the year 2000 feel unwell & apologise in retrospect)_\\n\\nThe nested spread operator gives this code **cubic time complexity** and will generate an insane amount of \\\"garbage\\\" intermediate arrays.\\n\\nThis isn't some pedantic performance point, it's the difference between working code and timing out!\\n\"}"},"is404":false,"path":"js-spread-operator"}</script>
    </head>
    <body>
      <div data-url="" display="none"></div>
      <div class="wrapper"><span class="elm-css-style-wrapper" style="display: none;"><style></style></span><div class="link-back"><a href="/">angusjf</a></div><div class="blog"><h1>On the Embarrassingly Poor Performance of JavaScript&#039;s Spread Operator</h1><p>Here is an example of immutable TypeScript code which is so inefficient it caused the lambda it was running on to time out.</p><p>Say we have a list of connections between airports:</p><div><style>.elmsh {color: #24292e;background: #ffffff;}.elmsh-hl {background: #fffbdd;}.elmsh-add {background: #eaffea;}.elmsh-del {background: #ffecec;}.elmsh-comm {color: #969896;}.elmsh1 {color: #005cc5;}.elmsh2 {color: #df5000;}.elmsh3 {color: #d73a49;}.elmsh4 {color: #0086b3;}.elmsh5 {color: #63a35c;}.elmsh6 {color: #005cc5;}.elmsh7 {color: #795da3;}</style><pre class="elmsh"><code class="elmsh"><span class="elmsh4 elmsh-js-dk">const</span> links <span class="elmsh3 elmsh-js-k">=</span> [ [<span class="elmsh2 elmsh-js-s">&#039;Heathrow&#039;</span>, <span class="elmsh2 elmsh-js-s">&#039;Paris&#039;</span>], [<span class="elmsh2 elmsh-js-s">&#039;Berlin&#039;</span>, <span class="elmsh2 elmsh-js-s">&#039;Brussels&#039;</span>] <span class="elmsh-comm">/* ... */</span> ];
</code></pre></div><p>And we want to format this data as a &quot;dictionary&quot;, from airport to it&#039;s potential destinations:</p><div><style>.elmsh {color: #24292e;background: #ffffff;}.elmsh-hl {background: #fffbdd;}.elmsh-add {background: #eaffea;}.elmsh-del {background: #ffecec;}.elmsh-comm {color: #969896;}.elmsh1 {color: #005cc5;}.elmsh2 {color: #df5000;}.elmsh3 {color: #d73a49;}.elmsh4 {color: #0086b3;}.elmsh5 {color: #63a35c;}.elmsh6 {color: #005cc5;}.elmsh7 {color: #795da3;}</style><pre class="elmsh"><code class="elmsh">{
    Heathrow<span class="elmsh3 elmsh-js-k">:</span> [<span class="elmsh2 elmsh-js-s">&#039;Paris&#039;</span>, <span class="elmsh2 elmsh-js-s">&#039;Berlin&#039;</span>, <span class="elmsh2 elmsh-js-s">&#039;Brussels&#039;</span>],
    Gatwick<span class="elmsh3 elmsh-js-k">:</span> [ <span class="elmsh-comm">/* ... */</span> ]
}
</code></pre></div><p>If we are strictly using immutable javascript, we end up with this:</p><div><style>.elmsh {color: #24292e;background: #ffffff;}.elmsh-hl {background: #fffbdd;}.elmsh-add {background: #eaffea;}.elmsh-del {background: #ffecec;}.elmsh-comm {color: #969896;}.elmsh1 {color: #005cc5;}.elmsh2 {color: #df5000;}.elmsh3 {color: #d73a49;}.elmsh4 {color: #0086b3;}.elmsh5 {color: #63a35c;}.elmsh6 {color: #005cc5;}.elmsh7 {color: #795da3;}</style><pre class="elmsh"><code class="elmsh"><span class="elmsh4 elmsh-js-dk">const</span> validDestinations <span class="elmsh3 elmsh-js-k">=</span> (links) <span class="elmsh3 elmsh-js-k">=&gt;</span>
    links<span class="elmsh3 elmsh-js-k">.</span><span class="elmsh4 elmsh-js-fe">reduce</span>(
        (acc, [from, to]) <span class="elmsh3 elmsh-js-k">=&gt;</span>
            ({ <span class="elmsh3 elmsh-js-k">...</span>acc,
               [from]<span class="elmsh3 elmsh-js-k">:</span> [ <span class="elmsh3 elmsh-js-k">...</span>(acc[from] <span class="elmsh3 elmsh-js-k">??</span> []), to ]
             }),
        {}
    )
</code></pre></div><p><em>(I know the number of symbols in the above snippet will make any reader born before the year 2000 feel unwell &amp; apologise in retrospect)</em></p><p>The nested spread operator gives this code <strong>cubic time complexity</strong> and will generate an insane amount of &quot;garbage&quot; intermediate arrays.</p><p>This isn&#039;t some pedantic performance point, it&#039;s the difference between working code and timing out!</p></div></div>
    </body>
  </html>
  